// ============================================
// GAME 1: BUDGET BOSS (Drag & Drop)
// ============================================
function loadBudgetBoss() {
    const container = document.getElementById('gameContainer');

    const expenses = [
        { name: 'Rent', amount: 800, category: 'essential', emoji: 'üè†' },
        { name: 'Groceries', amount: 300, category: 'essential', emoji: 'üõí' },
        { name: 'Utilities', amount: 150, category: 'essential', emoji: 'üí°' },
        { name: 'Transportation', amount: 100, category: 'essential', emoji: 'üöó' },
        { name: 'Netflix', amount: 15, category: 'wants', emoji: 'üì∫' },
        { name: 'Coffee Shops', amount: 80, category: 'wants', emoji: '‚òï' },
        { name: 'Dining Out', amount: 200, category: 'wants', emoji: 'üçï' },
        { name: 'New Shoes', amount: 120, category: 'wants', emoji: 'üëü' },
        { name: 'Emergency Fund', amount: 200, category: 'savings', emoji: 'üí∞' },
        { name: 'Investment', amount: 150, category: 'savings', emoji: 'üìà' }
    ];

    let gameState = {
        income: 2500,
        needs: { items: [], total: 0 },
        wants: { items: [], total: 0 },
        savings: { items: [], total: 0 },
        score: 0
    };

    container.innerHTML = `
        <div class="budget-game">
            <div class="budget-header">
                <div class="budget-income">
                    <div class="budget-label">Monthly Income</div>
                    <div class="budget-amount">$${gameState.income}</div>
                </div>
                <div class="budget-remaining">
                    <div class="budget-label">Remaining</div>
                    <div class="budget-amount" id="remaining">$${gameState.income}</div>
                </div>
            </div>

            <div class="budget-categories">
                <div class="budget-category" id="needs" data-category="needs">
                    <h3>Needs (50-60%)</h3>
                    <div class="category-total" id="needs-total">$0</div>
                    <div class="drop-zone"></div>
                </div>
                <div class="budget-category" id="wants" data-category="wants">
                    <h3>Wants (20-30%)</h3>
                    <div class="category-total" id="wants-total">$0</div>
                    <div class="drop-zone"></div>
                </div>
                <div class="budget-category" id="savings" data-category="savings">
                    <h3>Savings (20-30%)</h3>
                    <div class="category-total" id="savings-total">$0</div>
                    <div class="drop-zone"></div>
                </div>
            </div>

            <div class="expenses-pool">
                <h3>Drag Expenses to Categories</h3>
                <div class="expenses-grid" id="expensesPool"></div>
            </div>

            <button class="game-button primary" id="checkBudget">Check My Budget</button>
        </div>

        <style>
            .budget-game {
                max-width: 900px;
                margin: 0 auto;
                background: linear-gradient(135deg, rgba(255,255,255,0.02) 0%, rgba(255,255,255,0.01) 100%);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                border-radius: 24px;
                padding: 40px;
                border: 1px solid var(--glass-border);
                box-shadow: 0 8px 32px 0 var(--glass-shadow);
            }
            .budget-header {
                display: flex;
                justify-content: space-around;
                margin-bottom: 40px;
                gap: 25px;
            }
            .budget-income, .budget-remaining {
                flex: 1;
                background: var(--glass-surface);
                padding: 25px;
                border-radius: 20px;
                text-align: center;
                border: 1px solid var(--glass-border);
                box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.1);
                transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                backdrop-filter: blur(10px);
            }
            .budget-income:hover, .budget-remaining:hover {
                transform: translateY(-5px);
                border-color: var(--primary);
                box-shadow: 0 10px 20px rgba(0,0,0,0.2), 0 0 15px rgba(99, 102, 241, 0.2);
            }
            .budget-label {
                font-size: 14px;
                color: var(--text-secondary);
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 1.5px;
                font-weight: 600;
            }
            .budget-amount {
                font-size: 42px;
                font-weight: 800;
                color: var(--primary);
                text-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
            }
            .budget-categories {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 25px;
                margin-bottom: 40px;
            }
            .budget-category {
                background: var(--glass-surface);
                border-radius: 20px;
                padding: 25px;
                border: 2px dashed var(--glass-border);
                transition: all 0.3s ease;
                min-height: 250px;
                display: flex;
                flex-direction: column;
            }
            .budget-category:hover {
                background: rgba(255, 255, 255, 0.03);
            }
            .budget-category.drag-over {
                border-color: var(--neon-blue);
                background: rgba(0, 243, 255, 0.05);
                transform: scale(1.02);
                box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
            }
            .budget-category h3 {
                font-size: 18px;
                margin-bottom: 15px;
                text-align: center;
                color: var(--text-primary);
                font-weight: 700;
                letter-spacing: 0.5px;
            }
            .category-total {
                font-size: 28px;
                font-weight: 800;
                text-align: center;
                color: var(--success);
                margin-bottom: 20px;
                text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
            }
            .drop-zone {
                flex-grow: 1;
                border-radius: 12px;
                transition: background-color 0.2s;
            }
            .expenses-pool {
                background: var(--glass-surface);
                border-radius: 20px;
                padding: 30px;
                margin-bottom: 30px;
                border: 1px solid var(--glass-border);
            }
            .expenses-pool h3 {
                text-align: center;
                margin-bottom: 25px;
                color: var(--text-primary);
                font-size: 1.2rem;
            }
            .expenses-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 15px;
            }
            .expense-item {
                background: var(--card-bg);
                border: 1px solid var(--glass-border);
                border-radius: 50%;
                width: 120px;
                height: 120px;
                margin: 0 auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                cursor: grab;
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2), inset 0 2px 5px rgba(255,255,255,0.1);
                position: relative;
            }
            .expense-item::before {
                content: '';
                position: absolute;
                inset: 5px;
                border-radius: 50%;
                border: 2px dashed var(--glass-border);
                opacity: 0.5;
            }
            .expense-item:nth-child(even) { animation-delay: 0.1s; }
            .expense-item:nth-child(3n) { animation-delay: 0.2s; }
            
            @keyframes popIn {
                from { opacity: 0; transform: scale(0.5); }
                to { opacity: 1; transform: scale(1); }
            }
            
            .expense-item:active {
                cursor: grabbing;
                transform: scale(0.9);
            }
            .expense-item:hover {
                transform: translateY(-5px) scale(1.1);
                box-shadow: 0 15px 30px rgba(0,0,0,0.3);
                border-color: var(--primary);
                z-index: 10;
            }
            .expense-emoji {
                font-size: 32px;
                margin-bottom: 5px;
                z-index: 2;
            }
            .expense-name {
                font-weight: 700;
                margin-bottom: 2px;
                font-size: 12px;
                color: var(--text-primary);
                z-index: 2;
                max-width: 90%;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .expense-amount {
                color: var(--primary);
                font-weight: 800;
                font-size: 14px;
                z-index: 2;
            }
            .game-button {
                width: 100%;
                padding: 20px;
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                color: white;
                border: none;
                border-radius: 16px;
                font-size: 20px;
                font-weight: 700;
                cursor: pointer;
                font-family: inherit;
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
                position: relative;
                overflow: hidden;
            }
            .game-button::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 50%;
                height: 100%;
                background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
                transform: skewX(-25deg);
                transition: 0.5s;
            }
            .game-button:hover::after {
                left: 200%;
            }
            .game-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 15px 35px rgba(99, 102, 241, 0.6);
            }
            .game-button:active {
                transform: scale(0.98);
            }
            @media (max-width: 768px) {
                .budget-categories {
                    grid-template-columns: 1fr;
                }
                .budget-header {
                    flex-direction: column;
                }
            }
        </style>
    `;

    // Render expenses
    const pool = document.getElementById('expensesPool');
    pool.innerHTML = expenses.map((exp, i) => `
        <div class="expense-item" draggable="true" data-index="${i}">
            <div class="expense-emoji">${exp.emoji}</div>
            <div class="expense-name">${exp.name}</div>
            <div class="expense-amount">$${exp.amount}</div>
        </div>
    `).join('');

    // Drag and drop
    let draggedElement = null;

    document.querySelectorAll('.expense-item').forEach(item => {
        item.addEventListener('dragstart', (e) => {
            draggedElement = expenses[e.target.dataset.index];
            e.target.style.opacity = '0.5';
        });

        item.addEventListener('dragend', (e) => {
            e.target.style.opacity = '1';
        });
    });

    document.querySelectorAll('.budget-category').forEach(category => {
        category.addEventListener('dragover', (e) => {
            e.preventDefault();
            category.classList.add('drag-over');
        });

        category.addEventListener('dragleave', () => {
            category.classList.remove('drag-over');
        });

        category.addEventListener('drop', (e) => {
            e.preventDefault();
            category.classList.remove('drag-over');

            if (!draggedElement) return;

            const categoryName = category.dataset.category;
            gameState[categoryName].items.push(draggedElement);
            gameState[categoryName].total += draggedElement.amount;

            // Remove from pool
            const expenseIndex = expenses.indexOf(draggedElement);
            if (expenseIndex > -1) {
                expenses.splice(expenseIndex, 1);
                pool.innerHTML = expenses.map((exp, i) => `
                    <div class="expense-item" draggable="true" data-index="${i}">
                        <div class="expense-emoji">${exp.emoji}</div>
                        <div class="expense-name">${exp.name}</div>
                        <div class="expense-amount">$${exp.amount}</div>
                    </div>
                `).join('');

                // Re-add event listeners
                document.querySelectorAll('.expense-item').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggedElement = expenses[e.target.dataset.index];
                        e.target.style.opacity = '0.5';
                    });
                    item.addEventListener('dragend', (e) => {
                        e.target.style.opacity = '1';
                    });
                });
            }

            // Update UI
            updateBudgetUI();
            draggedElement = null;
        });
    });

    function updateBudgetUI() {
        const totalSpent = gameState.needs.total + gameState.wants.total + gameState.savings.total;
        const remaining = gameState.income - totalSpent;

        document.getElementById('remaining').textContent = `$${remaining}`;
        document.getElementById('remaining').style.color = remaining >= 0 ? 'var(--success)' : 'var(--danger)';

        document.getElementById('needs-total').textContent = `$${gameState.needs.total}`;
        document.getElementById('wants-total').textContent = `$${gameState.wants.total}`;
        document.getElementById('savings-total').textContent = `$${gameState.savings.total}`;
    }

    document.getElementById('checkBudget').addEventListener('click', () => {
        const totalSpent = gameState.needs.total + gameState.wants.total + gameState.savings.total;

        if (expenses.length > 0) {
            showNotification('Please allocate all expenses!', 'error');
            return;
        }

        const needsPercent = (gameState.needs.total / gameState.income) * 100;
        const wantsPercent = (gameState.wants.total / gameState.income) * 100;
        const savingsPercent = (gameState.savings.total / gameState.income) * 100;

        let score = 100;
        let feedback = [];

        // Check needs (should be 50-60%)
        if (needsPercent < 50) {
            score -= 20;
            feedback.push('‚ö†Ô∏è Your needs are too low. Make sure to cover essentials!');
        } else if (needsPercent > 60) {
            score -= 10;
            feedback.push('üí° Your needs are a bit high. Can you reduce fixed costs?');
        } else {
            feedback.push('‚úÖ Great job on managing needs!');
        }

        // Check wants (should be 20-30%)
        if (wantsPercent > 30) {
            score -= 15;
            feedback.push('‚ö†Ô∏è You\'re spending too much on wants. Time to cut back!');
        } else if (wantsPercent < 20) {
            feedback.push('üí° You have room for more fun expenses!');
        } else {
            feedback.push('‚úÖ Perfect balance on wants!');
        }

        // Check savings (should be 20-30%)
        if (savingsPercent < 20) {
            score -= 25;
            feedback.push('‚ö†Ô∏è You need to save more! Aim for at least 20%.');
        } else if (savingsPercent >= 20) {
            feedback.push('‚úÖ Excellent savings rate!');
        }

        // Check if over budget
        if (totalSpent > gameState.income) {
            score -= 30;
            feedback.push('‚ùå You\'re over budget! Reduce your expenses.');
        }

        score = Math.max(0, score);

        container.innerHTML = `
            <div style="text-align: center; padding: 40px;">
                <h2 style="font-size: 32px; margin-bottom: 20px;">Budget Analysis</h2>
                <div style="font-size: 48px; margin-bottom: 20px;">
                    ${score >= 80 ? 'üèÜ' : score >= 60 ? 'üëç' : 'üí™'}
                </div>
                <div style="font-size: 24px; font-weight: 700; color: var(--primary); margin-bottom: 30px;">
                    Score: ${score}/100
                </div>
                <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: left;">
                    ${feedback.map(f => `<p style="margin: 10px 0; font-size: 16px;">${f}</p>`).join('')}
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                    <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 12px;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Needs</div>
                        <div style="font-size: 24px; font-weight: 700;">${needsPercent.toFixed(0)}%</div>
                    </div>
                    <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 12px;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Wants</div>
                        <div style="font-size: 24px; font-weight: 700;">${wantsPercent.toFixed(0)}%</div>
                    </div>
                    <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 12px;">
                        <div style="font-size: 14px; color: var(--text-secondary);">Savings</div>
                        <div style="font-size: 24px; font-weight: 700;">${savingsPercent.toFixed(0)}%</div>
                    </div>
                </div>
            </div>
        `;

        finishGame(score, 100);
    });
}

// ============================================
// GAME 2: SAVINGS SPRINT (Arcade Game)
// ============================================
function loadSavingsSprint() {
    const container = document.getElementById('gameContainer');

    let gameState = {
        score: 0,
        lives: 3,
        speed: 2,
        items: [],
        playerX: 250,
        gameOver: false,
        animationId: null
    };

    container.innerHTML = `
        <div class="savings-game">
            <div class="game-info">
                <div class="info-item">
                    <span class="info-label">Savings:</span>
                    <span class="info-value" id="savingsScore">$0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Lives:</span>
                    <span class="info-value" id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
                </div>
            </div>
            <canvas id="gameCanvas" width="600" height="500"></canvas>
            <div class="game-controls">
                <button class="control-btn" id="moveLeft">‚¨ÖÔ∏è Left</button>
                <button class="control-btn" id="moveRight">‚û°Ô∏è Right</button>
            </div>
            <div class="game-instructions">
                <p>ü™ô Catch coins to save money | ‚ùå Avoid expenses!</p>
                <p>Use arrow keys or buttons to move</p>
            </div>
        </div>

        <style>
            .savings-game {
                text-align: center;
                position: relative;
                padding: 10px;
            }
            .game-info {
                display: flex;
                justify-content: space-around;
                margin-bottom: 30px;
                gap: 20px;
            }
            .info-item {
                background: var(--glass-surface);
                padding: 15px 30px;
                border-radius: 16px;
                border: 1px solid var(--glass-border);
                backdrop-filter: blur(10px);
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                flex: 1;
                max-width: 250px;
                transition: transform 0.3s ease;
            }
            .info-item:hover {
                transform: translateY(-5px);
                border-color: var(--neon-purple);
                box-shadow: 0 0 15px rgba(189, 0, 255, 0.3);
            }
            .info-label {
                font-size: 14px;
                color: var(--text-secondary);
                margin-right: 10px;
                text-transform: uppercase;
                letter-spacing: 1px;
                font-weight: 600;
            }
            .info-value {
                font-size: 28px;
                font-weight: 800;
                color: var(--primary);
                text-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
            }
            #gameCanvas {
                background: linear-gradient(180deg, #050511 0%, #1e1e2e 100%);
                border-radius: 20px;
                border: 2px solid rgba(255, 255, 255, 0.1);
                display: block;
                margin: 0 auto 30px;
                max-width: 100%;
                box-shadow: 0 0 30px rgba(99, 102, 241, 0.2), inset 0 0 50px rgba(0,0,0,0.5);
                transition: transform 0.3s ease;
            }
            .game-controls {
                display: flex;
                gap: 25px;
                justify-content: center;
                margin-bottom: 30px;
            }
            .control-btn {
                padding: 20px 40px;
                background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
                color: var(--text-primary);
                border: 1px solid var(--glass-border);
                border-radius: 16px;
                font-size: 20px;
                font-weight: 700;
                cursor: pointer;
                font-family: inherit;
                transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                backdrop-filter: blur(5px);
            }
            .control-btn:hover {
                background: var(--primary);
                color: white;
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(99, 102, 241, 0.4);
                border-color: transparent;
                text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            .control-btn:active {
                transform: translateY(2px);
            }
            .game-instructions {
                background: var(--glass-surface);
                padding: 20px;
                border-radius: 16px;
                font-size: 15px;
                color: var(--text-secondary);
                border: 1px dashed var(--glass-border);
                max-width: 600px;
                margin: 0 auto;
            }
            .game-instructions p {
                margin: 5px 0;
            }
        </style>
    `;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Game objects
    const goodItems = ['ü™ô', 'üí∞', 'üíµ', 'üíé'];
    const badItems = ['‚ùå', 'üí∏', 'üõí', 'üçî'];

    function createItem() {
        const isGood = Math.random() > 0.3;
        return {
            x: Math.random() * (canvas.width - 30),
            y: -30,
            width: 30,
            height: 30,
            emoji: isGood ? goodItems[Math.floor(Math.random() * goodItems.length)] : badItems[Math.floor(Math.random() * badItems.length)],
            isGood: isGood,
            value: isGood ? Math.floor(Math.random() * 50) + 10 : Math.floor(Math.random() * 30) + 10
        };
    }

    function drawPlayer() {
        ctx.font = '40px Arial';
        ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        ctx.shadowBlur = 10;
        ctx.fillText('üè¶', gameState.playerX - 20, canvas.height - 30);
        ctx.shadowBlur = 0;
    }

    function drawItems() {
        gameState.items.forEach(item => {
            ctx.font = '30px Arial';
            ctx.fillText(item.emoji, item.x, item.y);
        });
    }

    function updateGame() {
        if (gameState.gameOver) return;

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Add new items
        if (Math.random() < 0.03) {
            gameState.items.push(createItem());
        }

        // Update items
        gameState.items.forEach((item, index) => {
            item.y += gameState.speed;

            // Check collision with player
            if (
                item.y >= canvas.height - 60 &&
                item.y <= canvas.height - 20 &&
                item.x >= gameState.playerX - 40 &&
                item.x <= gameState.playerX + 20
            ) {
                if (item.isGood) {
                    gameState.score += item.value;
                    document.getElementById('savingsScore').textContent = `$${gameState.score}`;
                    playSound('success');
                } else {
                    gameState.lives--;
                    document.getElementById('lives').textContent = '‚ù§Ô∏è'.repeat(gameState.lives);
                    playSound('error');

                    if (gameState.lives <= 0) {
                        gameState.gameOver = true;
                        endGame();
                    }
                }
                gameState.items.splice(index, 1);
            }

            // Remove items that are off screen
            if (item.y > canvas.height) {
                gameState.items.splice(index, 1);
            }
        });

        // Increase difficulty
        gameState.speed = Math.min(5, 2 + gameState.score / 200);

        // Draw everything
        drawPlayer();
        drawItems();

        gameState.animationId = requestAnimationFrame(updateGame);
    }

    function endGame() {
        cancelAnimationFrame(gameState.animationId);
        finishGame(gameState.score, 500);
    }

    // Controls
    document.getElementById('moveLeft').addEventListener('click', () => {
        gameState.playerX = Math.max(40, gameState.playerX - 30);
    });

    document.getElementById('moveRight').addEventListener('click', () => {
        gameState.playerX = Math.min(canvas.width - 40, gameState.playerX + 30);
    });

    document.addEventListener('keydown', (e) => {
        if (gameState.gameOver) return;

        if (e.key === 'ArrowLeft') {
            gameState.playerX = Math.max(40, gameState.playerX - 30);
        } else if (e.key === 'ArrowRight') {
            gameState.playerX = Math.min(canvas.width - 40, gameState.playerX + 30);
        }
    });

    // Start game
    updateGame();

    // Auto end after 60 seconds
    setTimeout(() => {
        if (!gameState.gameOver) {
            gameState.gameOver = true;
            endGame();
        }
    }, 60000);
}

// ============================================
// GAME 3: INVESTMENT CLICKER
// ============================================
// ============================================
// GAME 3: INVESTMENT GROWTH (Interactive Redesign)
// ============================================
function loadInvestmentClicker() {
    const container = document.getElementById('gameContainer');

    let gameState = {
        balance: 1000,
        portfolio: {
            savings: 0,
            bonds: 0,
            stocks: 0
        },
        years: 0,
        targetYears: 10,
        history: [{ year: 0, total: 1000, savings: 0, bonds: 0, stocks: 0 }],
        events: [],
        marketCondition: 'normal',
        firstInvestments: { savings: false, bonds: false, stocks: false },
        diversified: false
    };

    const investmentTypes = {
        savings: { name: 'Savings Account', icon: 'üí∞', risk: 'Low', baseReturn: 0.03, volatility: 0 },
        bonds: { name: 'Bonds', icon: 'üìä', risk: 'Medium', baseReturn: 0.06, volatility: 0.02 },
        stocks: { name: 'Stocks', icon: 'üìà', risk: 'High', baseReturn: 0.12, volatility: 0.08 }
    };

    const marketEvents = [
        { year: 3, type: 'bull', message: 'üìà Bull Market! Stocks surge +25%!', effect: { stocks: 1.25 } },
        { year: 5, type: 'crash', message: 'üìâ Market Correction! Stocks drop -15%', effect: { stocks: 0.85 } },
        { year: 7, type: 'rates', message: 'üè¶ Interest Rate Hike! Bonds now 8%', effect: { bondsRate: 0.08 } },
        { year: 4, type: 'emergency', message: 'üí∏ Emergency Expense: -$150', effect: { balance: -150 } }
    ];

    container.innerHTML = `
        <div class="investment-game-v2">
            <!-- Header Stats -->
            <div class="inv-header">
                <div class="inv-stat-card balance">
                    <div class="stat-icon">üíµ</div>
                    <div class="stat-info">
                        <div class="stat-label">Available Cash</div>
                        <div class="stat-value" id="balanceValue">$1,000</div>
                    </div>
                </div>
                <div class="inv-stat-card portfolio">
                    <div class="stat-icon">üíº</div>
                    <div class="stat-info">
                        <div class="stat-label">Portfolio Value</div>
                        <div class="stat-value" id="portfolioValue">$0</div>
                    </div>
                </div>
                <div class="inv-stat-card years">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-info">
                        <div class="stat-label">Year</div>
                        <div class="stat-value" id="yearValue">0 / 10</div>
                    </div>
                </div>
            </div>

            <!-- Investment Options -->
            <div class="investment-options">
                <h3>Choose Your Investments</h3>
                <div class="investment-cards">
                    ${Object.entries(investmentTypes).map(([key, type]) => `
                        <div class="inv-card" data-type="${key}">
                            <div class="inv-card-header">
                                <span class="inv-icon">${type.icon}</span>
                                <span class="inv-name">${type.name}</span>
                            </div>
                            <div class="inv-card-body">
                                <div class="inv-risk ${type.risk.toLowerCase()}">${type.risk} Risk</div>
                                <div class="inv-return">${(type.baseReturn * 100).toFixed(0)}% avg return</div>
                                <div class="inv-amount" id="${key}Amount">$0</div>
                            </div>
                            <div class="inv-card-footer">
                                <input type="range" min="0" max="500" step="50" value="0" 
                                       class="inv-slider" id="${key}Slider">
                                <div class="slider-value" id="${key}SliderValue">$0</div>
                                <button class="inv-invest-btn" data-type="${key}">Invest</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <!-- Growth Visualization -->
            <div class="growth-section">
                <h3>Portfolio Growth Over Time</h3>
                <div class="growth-chart" id="growthChart">
                    <div class="chart-bars" id="chartBars"></div>
                    <div class="chart-labels">
                        <span>Year 0</span>
                        <span>Year 5</span>
                        <span>Year 10</span>
                    </div>
                </div>
            </div>

            <!-- Event Feed -->
            <div class="event-feed" id="eventFeed">
                <div class="event-item info">
                    <span class="event-icon">üí°</span>
                    <span>Start investing to grow your wealth!</span>
                </div>
            </div>

            <!-- Action Button -->
            <button class="year-advance-btn" id="advanceYear">
                <span class="btn-icon">‚è≠Ô∏è</span>
                <span class="btn-text">Advance to Next Year</span>
            </button>
        </div>

        <style>
            .investment-game-v2 {
                max-width: 1000px;
                margin: 0 auto;
                padding: 30px;
            }
            
            .inv-header {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .inv-stat-card {
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 16px;
                padding: 20px;
                display: flex;
                align-items: center;
                gap: 15px;
                transition: all 0.3s ease;
            }
            
            .inv-stat-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-lg);
                border-color: var(--primary);
            }
            
            .stat-icon {
                font-size: 36px;
            }
            
            .stat-label {
                font-size: 12px;
                color: var(--text-secondary);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 5px;
            }
            
            .stat-value {
                font-size: 24px;
                font-weight: 800;
                color: var(--primary);
            }
            
            .investment-options h3 {
                color: var(--text-primary);
                margin-bottom: 20px;
                font-size: 20px;
            }
            
            .investment-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .inv-card {
                background: var(--card-bg);
                border: 2px solid var(--border-color);
                border-radius: 16px;
                padding: 20px;
                transition: all 0.3s ease;
            }
            
            .inv-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-xl);
            }
            
            .inv-card-header {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .inv-icon {
                font-size: 32px;
            }
            
            .inv-name {
                font-size: 18px;
                font-weight: 700;
                color: var(--text-primary);
            }
            
            .inv-card-body {
                margin-bottom: 15px;
            }
            
            .inv-risk {
                display: inline-block;
                padding: 4px 12px;
                border-radius: 12px;
                font-size: 12px;
                font-weight: 600;
                margin-bottom: 8px;
            }
            
            .inv-risk.low {
                background: rgba(16, 185, 129, 0.2);
                color: var(--success);
            }
            
            .inv-risk.medium {
                background: rgba(245, 158, 11, 0.2);
                color: var(--warning);
            }
            
            .inv-risk.high {
                background: rgba(239, 68, 68, 0.2);
                color: var(--error);
            }
            
            .inv-return {
                font-size: 14px;
                color: var(--text-secondary);
                margin-bottom: 8px;
            }
            
            .inv-amount {
                font-size: 20px;
                font-weight: 700;
                color: var(--success);
            }
            
            .inv-card-footer {
                border-top: 1px solid var(--border-color);
                padding-top: 15px;
            }
            
            .inv-slider {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .slider-value {
                text-align: center;
                font-size: 16px;
                font-weight: 600;
                color: var(--primary);
                margin-bottom: 10px;
            }
            
            .inv-invest-btn {
                width: 100%;
                padding: 12px;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .inv-invest-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            }
            
            .inv-invest-btn:disabled {
                background: var(--bg-tertiary);
                color: var(--text-secondary);
                cursor: not-allowed;
                transform: none;
            }
            
            .growth-section {
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 16px;
                padding: 25px;
                margin-bottom: 25px;
            }
            
            .growth-section h3 {
                color: var(--text-primary);
                margin-bottom: 20px;
                font-size: 18px;
            }
            
            .growth-chart {
                position: relative;
                height: 200px;
                background: var(--bg-color);
                border-radius: 12px;
                padding: 20px;
            }
            
            .chart-bars {
                display: flex;
                align-items: flex-end;
                justify-content: space-around;
                height: 140px;
                gap: 5px;
            }
            
            .chart-bar {
                flex: 1;
                background: linear-gradient(to top, var(--primary), var(--success));
                border-radius: 4px 4px 0 0;
                min-height: 5px;
                transition: all 0.5s ease;
                position: relative;
            }
            
            .chart-bar:hover::after {
                content: attr(data-value);
                position: absolute;
                top: -30px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--bg-tertiary);
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                white-space: nowrap;
            }
            
            .chart-labels {
                display: flex;
                justify-content: space-between;
                margin-top: 10px;
                font-size: 12px;
                color: var(--text-secondary);
            }
            
            .event-feed {
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 16px;
                padding: 20px;
                margin-bottom: 25px;
                max-height: 150px;
                overflow-y: auto;
            }
            
            .event-item {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 10px;
                margin-bottom: 8px;
                border-radius: 8px;
                font-size: 14px;
                animation: slideIn 0.3s ease;
            }
            
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            
            .event-item.info {
                background: rgba(99, 102, 241, 0.1);
                color: var(--primary);
            }
            
            .event-item.success {
                background: rgba(16, 185, 129, 0.1);
                color: var(--success);
            }
            
            .event-item.warning {
                background: rgba(245, 158, 11, 0.1);
                color: var(--warning);
            }
            
            .event-item.error {
                background: rgba(239, 68, 68, 0.1);
                color: var(--error);
            }
            
            .event-icon {
                font-size: 18px;
            }
            
            .year-advance-btn {
                width: 100%;
                padding: 20px;
                background: linear-gradient(135deg, var(--success), #059669);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 18px;
                font-weight: 700;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            }
            
            .year-advance-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            }
            
            .year-advance-btn:active {
                transform: translateY(0);
            }
            
            .btn-icon {
                font-size: 24px;
            }
            
            /* Educational Modal */
            .edu-modal-investment {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .edu-modal-investment.active {
                opacity: 1;
                visibility: visible;
            }
            
            .edu-modal-content-inv {
                background: var(--card-bg);
                border-radius: 20px;
                padding: 35px;
                max-width: 500px;
                width: 90%;
                box-shadow: var(--shadow-xl);
                border: 2px solid var(--primary);
                animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            }
            
            @keyframes modalPop {
                from {
                    transform: scale(0.8);
                    opacity: 0;
                }
                to {
                    transform: scale(1);
                    opacity: 1;
                }
            }
            
            .edu-modal-header-inv {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .edu-modal-icon-inv {
                font-size: 42px;
            }
            
            .edu-modal-title-inv {
                font-size: 24px;
                font-weight: 800;
                color: var(--primary);
                margin: 0;
            }
            
            .edu-modal-body-inv {
                color: var(--text-primary);
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 25px;
            }
            
            .edu-modal-close-inv {
                width: 100%;
                padding: 12px;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .edu-modal-close-inv:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            }
            
            @media (max-width: 768px) {
                .investment-cards {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    `;

    // Initialize sliders
    Object.keys(investmentTypes).forEach(type => {
        const slider = document.getElementById(`${type}Slider`);
        const valueDisplay = document.getElementById(`${type}SliderValue`);

        slider.addEventListener('input', (e) => {
            valueDisplay.textContent = `$${e.target.value}`;
        });
    });

    // Investment button handlers
    document.querySelectorAll('.inv-invest-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const type = btn.dataset.type;
            const slider = document.getElementById(`${type}Slider`);
            const amount = parseInt(slider.value);

            if (amount > 0 && gameState.balance >= amount) {
                gameState.balance -= amount;
                gameState.portfolio[type] += amount;

                // Show educational popup on first investment
                if (!gameState.firstInvestments[type]) {
                    gameState.firstInvestments[type] = true;
                    showEducationalModal(type);
                }

                // Check for diversification
                checkDiversification();

                addEvent(`Invested $${amount} in ${investmentTypes[type].name}`, 'success');
                updateUI();
                playSound('click');

                // Reset slider
                slider.value = 0;
                document.getElementById(`${type}SliderValue`).textContent = '$0';
            } else if (amount > gameState.balance) {
                addEvent('Not enough cash available!', 'error');
                playSound('error');
            }
        });
    });

    // Advance year button
    document.getElementById('advanceYear').addEventListener('click', () => {
        advanceYear();
    });

    function advanceYear() {
        gameState.years++;

        // Apply returns
        let totalGrowth = 0;
        Object.keys(gameState.portfolio).forEach(type => {
            if (gameState.portfolio[type] > 0) {
                const typeData = investmentTypes[type];
                let returnRate = typeData.baseReturn;

                // Add volatility for stocks and bonds
                if (type === 'stocks') {
                    returnRate += (Math.random() - 0.5) * typeData.volatility * 2;
                } else if (type === 'bonds') {
                    returnRate += (Math.random() - 0.5) * typeData.volatility;
                }

                const growth = gameState.portfolio[type] * returnRate;
                gameState.portfolio[type] += growth;
                totalGrowth += growth;
            }
        });

        gameState.balance += totalGrowth;

        // Check for market events
        const event = marketEvents.find(e => e.year === gameState.years);
        if (event) {
            applyMarketEvent(event);
        }

        // Record history
        const totalPortfolio = Object.values(gameState.portfolio).reduce((a, b) => a + b, 0);
        gameState.history.push({
            year: gameState.years,
            total: gameState.balance,
            ...gameState.portfolio
        });

        if (totalGrowth > 0) {
            addEvent(`Year ${gameState.years}: Portfolio grew by $${totalGrowth.toFixed(2)}!`, 'success');
        }

        updateUI();
        updateChart();
        playSound('success');

        // Check if game is complete
        if (gameState.years >= gameState.targetYears) {
            endGame();
        }
    }

    function applyMarketEvent(event) {
        addEvent(event.message, event.type === 'crash' || event.type === 'emergency' ? 'warning' : 'info');

        if (event.effect.stocks) {
            gameState.portfolio.stocks *= event.effect.stocks;
        }
        if (event.effect.bondsRate) {
            investmentTypes.bonds.baseReturn = event.effect.bondsRate;
        }
        if (event.effect.balance) {
            gameState.balance += event.effect.balance;
        }
    }

    function checkDiversification() {
        const invested = Object.values(gameState.portfolio).filter(v => v > 0).length;
        if (invested >= 3 && !gameState.diversified) {
            gameState.diversified = true;
            showDiversificationModal();
        }
    }

    function showEducationalModal(type) {
        const lessons = {
            savings: {
                icon: 'üí∞',
                title: 'Savings Account',
                content: 'Great start! Savings accounts are the safest option with guaranteed returns. They\'re perfect for emergency funds and short-term goals. Low risk means low returns, but your money is always safe!'
            },
            bonds: {
                icon: 'üìä',
                title: 'Bonds Investment',
                content: 'Smart choice! Bonds offer moderate returns with less volatility than stocks. They\'re loans to companies or governments that pay you interest. Perfect for balanced portfolios!'
            },
            stocks: {
                icon: 'üìà',
                title: 'Stock Market',
                content: 'Bold move! Stocks have the highest potential returns but also the most risk. Prices fluctuate daily, but historically, stocks outperform other investments over the long term. Remember: don\'t panic sell during downturns!'
            }
        };

        const lesson = lessons[type];
        createModal(lesson.icon, lesson.title, lesson.content);
    }

    function showDiversificationModal() {
        createModal('üéØ', 'Diversification Achieved!',
            'Excellent strategy! You\'ve diversified across all three investment types. This reduces risk because when one investment type goes down, others might go up. "Don\'t put all your eggs in one basket!" +20 bonus points!');
    }

    function createModal(icon, title, content) {
        let modal = document.getElementById('eduModalInvestment');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'eduModalInvestment';
            modal.className = 'edu-modal-investment';
            modal.innerHTML = `
                <div class="edu-modal-content-inv">
                    <div class="edu-modal-header-inv">
                        <div class="edu-modal-icon-inv" id="modalIconInv"></div>
                        <h2 class="edu-modal-title-inv" id="modalTitleInv"></h2>
                    </div>
                    <div class="edu-modal-body-inv" id="modalBodyInv"></div>
                    <button class="edu-modal-close-inv" onclick="document.getElementById('eduModalInvestment').classList.remove('active')">Got it! üëç</button>
                </div>
            `;
            document.body.appendChild(modal);

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        }

        document.getElementById('modalIconInv').textContent = icon;
        document.getElementById('modalTitleInv').textContent = title;
        document.getElementById('modalBodyInv').textContent = content;

        setTimeout(() => {
            modal.classList.add('active');
        }, 300);
    }

    function addEvent(message, type = 'info') {
        const feed = document.getElementById('eventFeed');
        const event = document.createElement('div');
        event.className = `event-item ${type}`;

        const icons = { info: 'üí°', success: '‚úÖ', warning: '‚ö†Ô∏è', error: '‚ùå' };
        event.innerHTML = `
            <span class="event-icon">${icons[type]}</span>
            <span>${message}</span>
        `;

        feed.insertBefore(event, feed.firstChild);

        // Keep only last 5 events
        while (feed.children.length > 5) {
            feed.removeChild(feed.lastChild);
        }
    }

    function updateUI() {
        document.getElementById('balanceValue').textContent = `$${gameState.balance.toFixed(0)}`;

        const totalPortfolio = Object.values(gameState.portfolio).reduce((a, b) => a + b, 0);
        document.getElementById('portfolioValue').textContent = `$${totalPortfolio.toFixed(0)}`;
        document.getElementById('yearValue').textContent = `${gameState.years} / ${gameState.targetYears}`;

        // Update investment amounts
        Object.keys(investmentTypes).forEach(type => {
            document.getElementById(`${type}Amount`).textContent = `$${gameState.portfolio[type].toFixed(0)}`;
        });
    }

    function updateChart() {
        const chartBars = document.getElementById('chartBars');
        chartBars.innerHTML = '';

        const maxValue = Math.max(...gameState.history.map(h => h.total), 1000);

        gameState.history.forEach(record => {
            const bar = document.createElement('div');
            bar.className = 'chart-bar';
            const height = (record.total / maxValue) * 100;
            bar.style.height = `${height}%`;
            bar.setAttribute('data-value', `$${record.total.toFixed(0)}`);
            chartBars.appendChild(bar);
        });
    }

    function endGame() {
        const totalValue = gameState.balance;
        const profit = totalValue - 1000;
        const roi = ((profit / 1000) * 100).toFixed(1);

        // Calculate strategy score
        let score = Math.min(100, Math.round((totalValue / 2500) * 100));
        if (gameState.diversified) score = Math.min(100, score + 20);

        // Clean up modal
        const modal = document.getElementById('eduModalInvestment');
        if (modal) modal.remove();

        container.innerHTML = `
            <div style="text-align: center; padding: 40px; max-width: 600px; margin: 0 auto;">
                <div style="font-size: 80px; margin-bottom: 20px;">üéâ</div>
                <h2 style="font-size: 32px; margin-bottom: 15px; color: var(--text-primary);">Investment Journey Complete!</h2>
                <div style="background: var(--card-bg); padding: 30px; border-radius: 15px; margin: 20px 0; border: 1px solid var(--border-color);">
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--text-secondary); text-transform: uppercase;">Final Portfolio Value</div>
                        <div style="font-size: 42px; font-weight: 800; color: var(--success);">$${totalValue.toFixed(2)}</div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--text-secondary); text-transform: uppercase;">Total Profit</div>
                        <div style="font-size: 32px; font-weight: 700; color: var(--primary);">$${profit.toFixed(2)}</div>
                    </div>
                    <div>
                        <div style="font-size: 14px; color: var(--text-secondary); text-transform: uppercase;">Return on Investment</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--warning);">${roi}%</div>
                    </div>
                </div>
                ${gameState.diversified ? '<p style="font-size: 16px; color: var(--success); margin: 15px 0;">üéØ Diversification Bonus: +20 points!</p>' : ''}
                <p style="font-size: 16px; color: var(--text-secondary); margin: 20px 0;">
                    You invested over ${gameState.targetYears} years and learned about compound interest, risk management, and diversification!
                </p>
            </div>
        `;

        finishGame(score, 100);
    }

    updateUI();
    updateChart();
}

const container = document.getElementById('gameContainer');

let gameState = {
    balance: 1000,
    invested: 0,
    years: 0,
    interestRate: 0.07,
    clicks: 0,
    targetYears: 10
};

container.innerHTML = `
        <div class="investment-game">
            <div class="investment-header">
                <div class="balance-card">
                    <div class="card-label">Current Balance</div>
                    <div class="card-value">$${gameState.balance.toFixed(2)}</div>
                </div>
                <div class="balance-card">
                    <div class="card-label">Total Invested</div>
                    <div class="card-value invested">$${gameState.invested.toFixed(2)}</div>
                </div>
                <div class="balance-card">
                    <div class="card-label">Years Passed</div>
                    <div class="card-value">${gameState.years}/${gameState.targetYears}</div>
                </div>
            </div>

            <div class="investment-center">
                <div class="investment-visual">
                    <div class="money-pile" id="moneyPile">üí∞</div>
                    <div class="growth-indicator" id="growthIndicator">+0%</div>
                </div>
                <button class="invest-button" id="investButton">
                    Invest $100
                </button>
                <button class="year-button" id="yearButton">
                    ‚è≠Ô∏è Next Year
                </button>
            </div>

            <div class="investment-info">
                <h3>How Compound Interest Works</h3>
                <p>Each year, your investments grow by ${(gameState.interestRate * 100).toFixed(0)}%. The more you invest and the longer you wait, the more your money grows!</p>
                <div class="interest-formula">
                    <strong>Current Growth:</strong> $${(gameState.invested * gameState.interestRate).toFixed(2)}/year
                </div>
            </div>
        </div>

        <style>
            .investment-game {
                max-width: 800px;
                margin: 0 auto;
                background: linear-gradient(135deg, rgba(255,255,255,0.02) 0%, rgba(255,255,255,0.01) 100%);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                border-radius: 24px;
                padding: 40px;
                border: 1px solid var(--glass-border);
                box-shadow: 0 8px 32px 0 var(--glass-shadow);
            }
            .investment-header {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 25px;
                margin-bottom: 40px;
            }
            .balance-card {
                background: var(--glass-surface);
                padding: 25px;
                border-radius: 20px;
                text-align: center;
                border: 1px solid var(--glass-border);
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                backdrop-filter: blur(10px);
            }
            .balance-card:hover {
                transform: translateY(-8px) scale(1.02);
                border-color: var(--primary);
                box-shadow: 0 15px 30px rgba(0,0,0,0.3), 0 0 20px rgba(99, 102, 241, 0.2);
            }
            .card-label {
                font-size: 14px;
                color: var(--text-secondary);
                margin-bottom: 10px;
                text-transform: uppercase;
                letter-spacing: 1px;
                font-weight: 600;
            }
            .card-value {
                font-size: 32px;
                font-weight: 800;
                color: var(--primary);
                text-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
            }
            .card-value.invested {
                color: var(--success);
                text-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
            }
            .investment-center {
                background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
                padding: 40px;
                border-radius: 24px;
                text-align: center;
                margin-bottom: 40px;
                border: 1px solid var(--glass-border);
                box-shadow: inset 0 0 40px rgba(0,0,0,0.3);
                position: relative;
                overflow: hidden;
            }
            .investment-visual {
                position: relative;
                margin-bottom: 40px;
                height: 140px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }
            .money-pile {
                font-size: 90px;
                animation: floatMoney 3s ease-in-out infinite;
                display: inline-block;
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.3));
            }
            @keyframes floatMoney {
                0%, 100% { transform: translateY(0) scale(1); filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.3)); }
                50% { transform: translateY(-20px) scale(1.1); filter: drop-shadow(0 0 40px rgba(255, 215, 0, 0.5)); }
            }
            .growth-indicator {
                font-size: 28px;
                font-weight: 800;
                color: var(--success);
                margin-top: 15px;
                text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
            }
            .invest-button, .year-button {
                width: 100%;
                max-width: 350px;
                padding: 22px;
                margin: 20px auto;
                display: block;
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                color: white;
                border: none;
                border-radius: 18px;
                font-size: 22px;
                font-weight: 700;
                cursor: pointer;
                font-family: inherit;
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 10px 30px rgba(99, 102, 241, 0.5);
                position: relative;
                overflow: hidden;
            }
            .invest-button::after, .year-button::after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 50%;
                height: 100%;
                background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
                transform: skewX(-25deg);
                transition: 0.5s;
            }
            .invest-button:hover::after, .year-button:hover::after {
                left: 200%;
            }
            .invest-button:hover, .year-button:hover {
                transform: scale(1.05) translateY(-5px);
                box-shadow: 0 15px 40px rgba(99, 102, 241, 0.7);
            }
            .invest-button:active, .year-button:active {
                transform: scale(0.98);
            }
            .invest-button {
                animation: pulseButton 2s infinite;
            }
            @keyframes pulseButton {
                0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.6); }
                70% { box-shadow: 0 0 0 20px rgba(99, 102, 241, 0); }
                100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
            }
            .invest-button:disabled {
                background: var(--bg-tertiary);
                color: var(--text-secondary);
                cursor: not-allowed;
                transform: none;
                animation: none;
                box-shadow: none;
                opacity: 0.6;
            }
            .year-button {
                background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
                box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
            }
            .year-button:hover {
                box-shadow: 0 15px 40px rgba(16, 185, 129, 0.7);
            }
            .investment-info {
                background: var(--glass-surface);
                padding: 30px;
                border-radius: 20px;
                text-align: center;
                border: 1px solid var(--glass-border);
            }
            .investment-info h3 {
                margin-bottom: 20px;
                color: var(--primary);
                font-size: 1.4rem;
                text-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
            }
            .investment-info p {
                line-height: 1.8;
                color: var(--text-secondary);
                margin-bottom: 25px;
                font-size: 16px;
            }
            .interest-formula {
                background: rgba(0, 0, 0, 0.3);
                padding: 20px;
                border-radius: 15px;
                font-size: 18px;
                border: 1px dashed var(--glass-border);
                color: var(--text-primary);
                font-family: monospace;
            }
            @media (max-width: 768px) {
                .investment-header {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    `;

function updateUI() {
    document.querySelector('.balance-card .card-value').textContent = `$${gameState.balance.toFixed(2)}`;
    document.querySelector('.balance-card .invested').textContent = `$${gameState.invested.toFixed(2)}`;
    document.querySelector('.balance-card:last-child .card-value').textContent = `${gameState.years}/${gameState.targetYears}`;
    document.querySelector('.interest-formula').innerHTML = `<strong>Current Growth:</strong> $${(gameState.invested * gameState.interestRate).toFixed(2)}/year`;

    const investButton = document.getElementById('investButton');
    if (gameState.balance < 100) {
        investButton.disabled = true;
        investButton.textContent = 'Not Enough Money';
    } else {
        investButton.disabled = false;
        investButton.textContent = 'Invest $100';
    }
}

document.getElementById('investButton').addEventListener('click', () => {
    if (gameState.balance >= 100) {
        gameState.balance -= 100;
        gameState.invested += 100;
        gameState.clicks++;

        const pile = document.getElementById('moneyPile');
        pile.style.animation = 'none';
        setTimeout(() => {
            pile.style.animation = 'floatMoney 3s ease-in-out infinite';
        }, 10);

        updateUI();
        playSound('click');

        if (gameState.clicks % 5 === 0) {
            showNotification('Great investing! Keep it up! üí∞', 'success');
        }
    }
});

document.getElementById('yearButton').addEventListener('click', () => {
    gameState.years++;
    const growth = gameState.invested * gameState.interestRate;
    gameState.invested += growth;
    gameState.balance += growth;

    document.getElementById('growthIndicator').textContent = `+${(gameState.interestRate * 100).toFixed(0)}% ($${growth.toFixed(2)})`;
    document.getElementById('growthIndicator').style.animation = 'none';
    setTimeout(() => {
        document.getElementById('growthIndicator').style.animation = 'pulse 0.5s ease';
    }, 10);

    updateUI();
    playSound('success');

    if (gameState.years >= gameState.targetYears) {
        // Game complete
        const finalAmount = gameState.invested;
        const initialInvestment = 1000;
        const profit = finalAmount - initialInvestment;
        const roi = ((profit / initialInvestment) * 100).toFixed(1);

        container.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 80px; margin-bottom: 20px;">üéâ</div>
                    <h2 style="font-size: 32px; margin-bottom: 15px;">Investment Complete!</h2>
                    <div style="background: var(--bg-tertiary); padding: 30px; border-radius: 15px; margin: 20px 0;">
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--text-secondary);">Final Portfolio Value</div>
                            <div style="font-size: 42px; font-weight: 800; color: var(--success);">$${finalAmount.toFixed(2)}</div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--text-secondary);">Total Profit</div>
                            <div style="font-size: 32px; font-weight: 700; color: var(--primary);">$${profit.toFixed(2)}</div>
                        </div>
                        <div>
                            <div style="font-size: 16px; color: var(--text-secondary);">Return on Investment (ROI)</div>
                            <div style="font-size: 28px; font-weight: 700; color: var(--warning);">${roi}%</div>
                        </div>
                    </div>
                    <p style="font-size: 18px; color: var(--text-secondary); margin: 20px 0;">
                        You made ${gameState.clicks} investments over ${gameState.targetYears} years!
                    </p>
                </div>
            `;

        const score = Math.min(100, Math.round((finalAmount / 2000) * 100));
        finishGame(score, 100);
    }
});

updateUI();
}
